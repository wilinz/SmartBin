# 🔍 摄像头缩放功能使用指南 - 热更改模式

## 📋 功能概述

SmartBin系统新增了摄像头缩放功能，允许用户灵活调节摄像头视野范围，适应不同的检测场景需求。

## 🔥 热更改功能 (新增)

**重大更新**: 现在支持在实时预览和检测过程中热更改所有设置，无需停止检测！

### 热更改特点
- **实时调节**: 在检测运行时可随时调整缩放和矫正设置
- **无缝体验**: 无需停止检测，设置立即生效
- **智能反馈**: 实时显示当前设置状态和效果
- **流畅操作**: 所有控件在检测时保持可用

## 🚀 功能特性

### 缩放范围
- **最小缩放**: 0.5x (缩小视野，查看更广范围)
- **原始大小**: 1.0x (最佳视野，推荐设置)
- **最大缩放**: 3.0x (放大视野，查看细节)

### 精确控制
- **步进调节**: 0.1x 精度调节
- **实时预览**: 滑块调节时实时显示效果
- **一键重置**: 快速回到原始大小
- **快捷切换**: 1.0x ↔ 2.0x 快速切换

## 🎛️ 操作方法

### 主界面操作

1. **启动系统**
   - 打开 SmartBin 主页面
   - 在左侧控制面板找到"🔍 摄像头缩放"部分

2. **调节缩放**
   - 拖动滑块调节缩放倍数
   - 实时查看右侧数值显示
   - 观察视频预览变化

3. **快捷操作**
   - 点击"🔄 重置"回到 1.0x
   - 点击"🔍 放大2x"或"🔍 还原"快速切换

4. **热更改操作 (新增)**
   - 🔥 在检测运行时可随时调节缩放
   - 🔥 在检测运行时可切换镜头矫正
   - 🔥 实时查看效果和状态反馈

### 测试页面操作

1. **访问测试页面**
   - 打开 `http://localhost:3002/test_calibration.html`

2. **独立测试**
   - 启动摄像头
   - 调节"缩放倍数"滑块
   - 观察处理后画面的变化

3. **热更改测试 (新增)**
   - 🔥 在摄像头运行时实时调节缩放
   - 🔥 在视频播放时切换镜头矫正
   - 🔥 查看实时状态反馈信息

## 🔧 技术实现

### 处理流程

```
原始视频帧 → 镜头矫正 → 缩放处理 → 显示/检测
```

### 缩放算法

1. **获取原始图像数据**
2. **计算缩放后尺寸**: `scaledWidth = originalWidth × zoom`
3. **居中定位**: 保持图像在画布中心
4. **重绘图像**: 应用新的尺寸和位置

### 性能优化

- **Canvas 缓存**: 使用临时画布减少重复计算
- **实时处理**: 30fps 流畅缩放
- **内存管理**: 自动清理临时资源

## 📊 使用场景

### 不同缩放倍数的适用场景

| 缩放倍数 | 视野范围 | 适用场景 | 检测精度 |
|---------|---------|---------|---------|
| 0.5x - 0.8x | 更广视野 | 多目标检测、全景监控 | 中等 |
| 0.9x - 1.1x | 标准视野 | 日常使用、平衡检测 | 最佳 |
| 1.2x - 2.0x | 聚焦视野 | 精确检测、细节分析 | 高 |
| 2.1x - 3.0x | 放大视野 | 小物体检测、质量检查 | 极高 |

### 最佳实践

1. **初始设置**: 建议使用 1.0x 开始
2. **多目标场景**: 使用 0.7x - 0.8x 扩大视野
3. **精确检测**: 使用 1.5x - 2.0x 提高精度
4. **小物体检测**: 使用 2.5x - 3.0x 最大化细节

### 热更改使用建议 (新增)

1. **实时调节**: 在检测过程中发现效果不佳时，立即调节缩放倍数
2. **动态优化**: 根据不同垃圾类型实时调整最佳缩放比例
3. **快速切换**: 利用预设按钮在常用倍数间快速切换
4. **状态监控**: 关注实时状态反馈，了解当前设置效果

## ⚙️ 与其他功能的协作

### 镜头矫正兼容性
- ✅ 完全兼容镜头矫正功能
- ✅ 处理顺序: 矫正 → 缩放
- ✅ 同时启用时效果叠加

### AI检测集成
- ✅ 缩放后的图像用于AI检测
- ✅ 检测框坐标自动适配缩放比例
- ✅ 机械臂定位基于缩放后坐标

### 实时性能
- ✅ 30fps 流畅处理
- ✅ 低延迟响应
- ✅ 内存使用优化

## 🔧 注意事项

### 使用限制
- **调节时机**: ✅ 支持检测运行时实时调节 (热更改)
- **性能影响**: 高倍数缩放可能增加计算负载
- **视野范围**: 过度缩放可能影响检测范围

### 推荐设置
- **日常使用**: 1.0x
- **多目标**: 0.8x
- **精确检测**: 1.5x
- **细节查看**: 2.0x

## 🐛 故障排除

### 常见问题

1. **缩放效果不明显**
   - 检查缩放倍数是否正确设置
   - 确认视频流正常工作

2. **性能问题**
   - 降低缩放倍数
   - 检查设备性能

3. **检测精度下降**
   - 调整缩放倍数到最适合范围
   - 平衡视野范围与检测精度

### 调试技巧

```javascript
// 检查缩放状态
console.log('当前缩放:', cameraZoom)
console.log('偏移位置:', zoomOffsetX, zoomOffsetY)

// 重置到最佳状态
setCameraZoom(1.0)
setZoomOffsetX(0)
setZoomOffsetY(0)
```

## 📈 未来改进

### 已实现功能
- ✅ 热更改功能 (实时调节)
- ✅ 实时状态反馈
- ✅ 检测运行时调节

### 计划功能
- 🔄 拖拽平移功能
- 🔄 鼠标滚轮缩放
- 🔄 预设缩放位置
- 🔄 智能自动缩放

### 性能优化
- 🔄 GPU 加速处理
- 🔄 WebGL 渲染优化
- 🔄 自适应质量调节

---

*摄像头缩放功能与镜头矫正功能完美配合，结合全新的热更改功能，为 SmartBin 系统提供更灵活、更智能的视觉处理能力。用户现在可以在检测过程中实时调节所有设置，获得最佳的检测效果。* 